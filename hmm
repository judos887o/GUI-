local TweenService = game:GetService("TweenService")
local SoundService = game:GetService("SoundService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")

local old = CoreGui:FindFirstChild("SchmecktHub")
if old then old:Destroy() end

local lp = Players.LocalPlayer
local DISCORD_INVITE = "https://discord.gg/RCpsTAAsrN"
local INTRO_LOGO_ASSET = "rbxassetid://121759217057084"
local GUI_OPEN_SOUND = "rbxassetid://1862043663"

local THEME = {
    BgMain    = Color3.fromRGB(90, 0, 0),
    BgTop     = Color3.fromRGB(140, 0, 0),
    BgInner   = Color3.fromRGB(120, 0, 0),
    Sidebar   = Color3.fromRGB(110, 0, 0),
    Content   = Color3.fromRGB(120, 0, 0),
    Card      = Color3.fromRGB(135, 0, 0),
    Card2     = Color3.fromRGB(150, 0, 0),
    Stroke1   = Color3.fromRGB(255, 110, 110),
    Stroke2   = Color3.fromRGB(255, 150, 150),
    TabIdle   = Color3.fromRGB(140, 0, 0),
    TabActive = Color3.fromRGB(185, 0, 0),
    ToggleOff = Color3.fromRGB(175, 50, 120),
    ToggleOn  = Color3.fromRGB(0, 180, 80),
    MethodActive = Color3.fromRGB(140, 70, 200),
    MethodNone = Color3.fromRGB(80, 40, 80),
    Text      = Color3.fromRGB(255, 255, 255),
    SubText   = Color3.fromRGB(255, 210, 210),
    Warning   = Color3.fromRGB(255, 180, 50),
}

getgenv().SchmecktHubPC = getgenv().SchmecktHubPC or {}
local Shared = getgenv().SchmecktHubPC

Shared.TotalExecutions = (Shared.TotalExecutions or 0) + 1

Shared.AutoArmor = false
Shared.StaffNotifier = false
Shared.TriggerBot = false
Shared.Camlock = false
Shared.SilentAim = false
Shared.SilentAimMethod = nil
Shared.Desync = false
Shared.DisableDesync = false
Shared.FpsBoost = false
Shared.AutoReload = false
Shared.PlayerPanel = false
Shared.DragShoot = false
Shared.TargetUsername = nil
Shared.AutoKatanaKill = false
Shared.Fling = false
Shared.HighlightTarget = false
Shared.ViewTarget = false
Shared.GotoTarget = false
Shared.InstantStomp = false

-- Connection Management für Scripts
Shared.Connections = Shared.Connections or {}

local function safeLoad(url, key)
    task.spawn(function()
        local ok, err = pcall(function() loadstring(game:HttpGet(url, true))() end)
        if not ok then warn("[SchmecktHub] Failed to load", key, ":", err) end
    end)
end

local function Load_AutoArmor() safeLoad("https://raw.githubusercontent.com/judos887o/auto-armor/refs/heads/main/ar", "AutoArmor") end
local function Load_StaffNotifier() safeLoad("https://raw.githubusercontent.com/judos887o/staff-notifie/refs/heads/main/a", "StaffNotifier") end
local function Load_TriggerBot() safeLoad("https://raw.githubusercontent.com/judos887o/TRIGGERBOT-pc/refs/heads/main/trigger", "TriggerBot") end
local function Load_Camlock() safeLoad("https://raw.githubusercontent.com/judos887o/camlock-pc/refs/heads/main/camlcok", "Camlock") end
local function Load_SilentAim_FOV() safeLoad("https://raw.githubusercontent.com/judos887o/silent-aim-FOV-METHOD/refs/heads/main/teat", "SilentAim_FOV") end
local function Load_SilentAim_QMethod() safeLoad("https://raw.githubusercontent.com/judos887o/Silent-Aim/refs/heads/main/silent", "SilentAim_QMethod") end
local function Load_PlayerPanel() safeLoad("https://raw.githubusercontent.com/judos887o/PlayerGui-Da-hood-script-schmeckt/refs/heads/main/teat", "PlayerPanel") end
local function Load_AutoReload_S() safeLoad("https://raw.githubusercontent.com/judos887o/Auto-reload-da-hood-schmeckt/refs/heads/main/teat", "AutoReload_S") end
local function Load_DragShoot() safeLoad("https://raw.githubusercontent.com/judos887o/drag-shoot-da-hood-schmeckt/refs/heads/main/teat", "DragShoot") end
local function Load_Desync() safeLoad("https://raw.githubusercontent.com/judos887o/desync-schmeckt/refs/heads/main/teat", "Desync") end
local function Load_DisableDesync() safeLoad("https://raw.githubusercontent.com/judos887o/disdes/refs/heads/main/teat", "DisableDesync") end
local function Load_FpsBoost() safeLoad("https://raw.githubusercontent.com/judos887o/fps-nuke/refs/heads/main/teat", "FpsBoost") end
local function Load_Target() safeLoad("https://raw.githubusercontent.com/judos887o/target-schmeckt/refs/heads/main/teat", "Target") end
local function Load_InstantStomp() safeLoad("https://raw.githubusercontent.com/judos887o/momenzinstants/refs/heads/main/teats", "InstantStomp") end

local function DisableAllScripts()
    for k in pairs(Shared) do if type(Shared[k]) == "boolean" then Shared[k] = false end end
    Shared.TargetUsername = nil
    Shared.SilentAimMethod = nil
end

local function corner(inst, px)
    local c = Instance.new("UICorner")
    c.CornerRadius = UDim.new(0, px or 10)
    c.Parent = inst
    return c
end

local function stroke(inst, color, thickness, transparency)
    local s = Instance.new("UIStroke")
    s.Color = color
    s.Thickness = thickness or 1
    s.Transparency = transparency or 0
    s.Parent = inst
    return s
end

local function padding(inst, l, r, t, b)
    local p = Instance.new("UIPadding")
    p.PaddingLeft = UDim.new(0, l or 0)
    p.PaddingRight = UDim.new(0, r or 0)
    p.PaddingTop = UDim.new(0, t or 0)
    p.PaddingBottom = UDim.new(0, b or 0)
    p.Parent = inst
    return p
end

local clickSound = Instance.new("Sound")
clickSound.SoundId = "rbxassetid://15675059323"
clickSound.Volume = 1.4
clickSound.Parent = SoundService

local hoverSound = Instance.new("Sound")
hoverSound.SoundId = "rbxassetid://107511012621133"
hoverSound.Volume = 1.2
hoverSound.Parent = SoundService

local errorSound = Instance.new("Sound")
errorSound.SoundId = "rbxassetid://9116367596"
errorSound.Volume = 1.0
errorSound.Parent = SoundService

local function replaySound(snd) if snd.IsPlaying then snd.TimePosition = 0 end snd:Play() end
local function addButtonSounds(btn)
    btn.MouseButton1Click:Connect(function() replaySound(clickSound) end)
    btn.MouseEnter:Connect(function() replaySound(hoverSound) end)
end

local allRows = {}
local allScrollFrames = {}

local function registerRowForAnimation(row)
    table.insert(allRows, row)
    if row:IsA("Frame") then
        row.BackgroundTransparency = 1
    elseif row:IsA("TextButton") then
        row.BackgroundTransparency = 1
        row.TextTransparency = 1
    elseif row:IsA("TextLabel") then
        row.BackgroundTransparency = row.BackgroundTransparency
        row.TextTransparency = 1
    end
    for _, child in ipairs(row:GetDescendants()) do
        if child:IsA("TextLabel") then
            child.TextTransparency = 1
        elseif child:IsA("TextButton") then
            child.BackgroundTransparency = 1
            child.TextTransparency = 1
        elseif child:IsA("ImageLabel") then
            child.ImageTransparency = 1
        end
    end
end

local gui = Instance.new("ScreenGui")
gui.Name = "SchmecktHub"
gui.IgnoreGuiInset = true
gui.ResetOnSpawn = false
gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
gui.Parent = CoreGui

gui.AncestryChanged:Connect(function(_, parent) if not parent then DisableAllScripts() end end)

local main = Instance.new("Frame")
main.Name = "Main"
main.AnchorPoint = Vector2.new(0.5, 0.5)
main.Position = UDim2.new(0.5, 0, 0.5, 0)
main.Size = UDim2.new(0, 740, 0, 460)
main.BackgroundColor3 = THEME.BgMain
main.BorderSizePixel = 0
main.ZIndex = 2
main.ClipsDescendants = true
main.Parent = gui
main.Visible = false
corner(main, 14)
stroke(main, THEME.Stroke1, 2, 0)

local NORMAL_SIZE = main.Size

local topBar = Instance.new("Frame")
topBar.Name = "TopBar"
topBar.BackgroundColor3 = THEME.BgTop
topBar.BorderSizePixel = 0
topBar.Size = UDim2.new(1, -18, 0, 52)
topBar.Position = UDim2.new(0, 9, 0, 9)
topBar.ZIndex = 3
topBar.Parent = main
corner(topBar, 14)
stroke(topBar, THEME.Stroke2, 1, 0.15)

local topGrad = Instance.new("UIGradient")
topGrad.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(165, 0, 0)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(120, 0, 0)),
})
topGrad.Rotation = 0
topGrad.Parent = topBar

local closeBtn = Instance.new("TextButton")
closeBtn.Name = "Close"
closeBtn.BackgroundColor3 = Color3.fromRGB(220, 40, 40)
closeBtn.Size = UDim2.new(0, 30, 0, 30)
closeBtn.Position = UDim2.new(0, 10, 0.5, -15)
closeBtn.Font = Enum.Font.GothamBold
closeBtn.Text = "X"
closeBtn.TextColor3 = THEME.Text
closeBtn.TextSize = 14
closeBtn.ZIndex = 4
closeBtn.Parent = topBar
corner(closeBtn, 10)
addButtonSounds(closeBtn)

local miniBtn = Instance.new("TextButton")
miniBtn.Name = "Minimize"
miniBtn.BackgroundColor3 = Color3.fromRGB(200, 55, 55)
miniBtn.Size = UDim2.new(0, 30, 0, 30)
miniBtn.Position = UDim2.new(0, 46, 0.5, -15)
miniBtn.Font = Enum.Font.GothamBold
miniBtn.Text = "–"
miniBtn.TextColor3 = THEME.Text
miniBtn.TextSize = 18
miniBtn.ZIndex = 4
miniBtn.Parent = topBar
corner(miniBtn, 10)
addButtonSounds(miniBtn)

local topLogo = Instance.new("ImageLabel")
topLogo.Name = "IntroLogoTop"
topLogo.BackgroundTransparency = 1
topLogo.Size = UDim2.new(0, 34, 0, 34)
topLogo.Position = UDim2.new(0, 90, 0.5, -17)
topLogo.Image = INTRO_LOGO_ASSET
topLogo.ImageTransparency = 0
topLogo.ScaleType = Enum.ScaleType.Crop
topLogo.ZIndex = 4
topLogo.Parent = topBar
corner(topLogo, 999)
stroke(topLogo, THEME.Stroke2, 1, 0.25)

local title = Instance.new("TextLabel")
title.BackgroundTransparency = 1
title.Position = UDim2.new(0, 132, 0, 0)
title.Size = UDim2.new(1, -142, 1, 0)
title.Font = Enum.Font.GothamBlack
title.Text = "SCHMECKT X SHADOWPEPPER HUB"
title.TextColor3 = THEME.Text
title.TextSize = 19
title.TextXAlignment = Enum.TextXAlignment.Left
title.ZIndex = 4
title.Parent = topBar

local inner = Instance.new("Frame")
inner.Name = "Inner"
inner.BackgroundColor3 = THEME.BgInner
inner.BorderSizePixel = 0
inner.Position = UDim2.new(0, 9, 0, 70)
inner.Size = UDim2.new(1, -18, 1, -79)
inner.ZIndex = 2
inner.ClipsDescendants = true
inner.Parent = main
corner(inner, 14)
stroke(inner, THEME.Stroke2, 1, 0.2)

local sidebar = Instance.new("Frame")
sidebar.Name = "Sidebar"
sidebar.BackgroundColor3 = THEME.Sidebar
sidebar.BorderSizePixel = 0
sidebar.Position = UDim2.new(0, 10, 0, 10)
sidebar.Size = UDim2.new(0, 190, 1, -20)
sidebar.ZIndex = 3
sidebar.ClipsDescendants = false
sidebar.Parent = inner
corner(sidebar, 14)
stroke(sidebar, THEME.Stroke1, 1, 0.25)
padding(sidebar, 8, 8, 10, 10)

local tabsHeader = Instance.new("TextLabel")
tabsHeader.BackgroundColor3 = THEME.Card2
tabsHeader.Size = UDim2.new(1, 0, 0, 28)
tabsHeader.Font = Enum.Font.GothamSemibold
tabsHeader.Text = "Tabs"
tabsHeader.TextColor3 = THEME.Text
tabsHeader.TextSize = 16
tabsHeader.ZIndex = 4
tabsHeader.Parent = sidebar
corner(tabsHeader, 10)

local tabsContainer = Instance.new("Frame")
tabsContainer.BackgroundTransparency = 1
tabsContainer.Position = UDim2.new(0, 0, 0, 36)
tabsContainer.Size = UDim2.new(1, 0, 1, -110)
tabsContainer.ZIndex = 4
tabsContainer.Parent = sidebar

local listTabs = Instance.new("UIListLayout")
listTabs.FillDirection = Enum.FillDirection.Vertical
listTabs.SortOrder = Enum.SortOrder.LayoutOrder
listTabs.Padding = UDim.new(0, 8)
listTabs.Parent = tabsContainer

local profile = Instance.new("Frame")
profile.BackgroundColor3 = THEME.Card
profile.BorderSizePixel = 0
profile.Size = UDim2.new(1, 0, 0, 64)
profile.Position = UDim2.new(0, 0, 1, -64)
profile.ZIndex = 4
profile.Parent = sidebar
corner(profile, 14)
stroke(profile, THEME.Stroke2, 1, 0.35)

local avatarImg = Instance.new("ImageLabel")
avatarImg.BackgroundTransparency = 1
avatarImg.Size = UDim2.new(0, 44, 0, 44)
avatarImg.Position = UDim2.new(0, 10, 0.5, -22)
avatarImg.ZIndex = 5
avatarImg.Parent = profile
corner(avatarImg, 999)

local nameLabel = Instance.new("TextLabel")
nameLabel.BackgroundTransparency = 1
nameLabel.Position = UDim2.new(0, 62, 0, 12)
nameLabel.Size = UDim2.new(1, -70, 0, 18)
nameLabel.Font = Enum.Font.GothamSemibold
nameLabel.TextColor3 = THEME.Text
nameLabel.TextSize = 15
nameLabel.TextXAlignment = Enum.TextXAlignment.Left
nameLabel.ZIndex = 5
nameLabel.Parent = profile

local subNameLabel = Instance.new("TextLabel")
subNameLabel.BackgroundTransparency = 1
subNameLabel.Position = UDim2.new(0, 62, 0, 32)
subNameLabel.Size = UDim2.new(1, -70, 0, 16)
subNameLabel.Font = Enum.Font.Gotham
subNameLabel.TextColor3 = THEME.SubText
subNameLabel.TextSize = 13
subNameLabel.TextXAlignment = Enum.TextXAlignment.Left
subNameLabel.ZIndex = 5
subNameLabel.Parent = profile

if lp then
    nameLabel.Text = lp.DisplayName or lp.Name
    subNameLabel.Text = "@" .. lp.Name
    local ok, img = pcall(function() return Players:GetUserThumbnailAsync(lp.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size100x100) end)
    if ok and img then avatarImg.Image = img end
else
    nameLabel.Text = "Player"
    subNameLabel.Text = "@Unknown"
end

local content = Instance.new("Frame")
content.Name = "Content"
content.BackgroundColor3 = THEME.Content
content.BorderSizePixel = 0
content.Position = UDim2.new(0, 210, 0, 10)
content.Size = UDim2.new(1, -220, 1, -20)
content.ZIndex = 3
content.ClipsDescendants = true
content.Parent = inner
corner(content, 14)
stroke(content, THEME.Stroke1, 1, 0.25)

local function createToggleRow(parent, text, order, callback)
    local row = Instance.new("Frame")
    row.BackgroundColor3 = THEME.Card
    row.BorderSizePixel = 0
    row.Size = UDim2.new(1, 0, 0, 38)
    row.ZIndex = 4
    row.LayoutOrder = order or 0
    row.Parent = parent
    corner(row, 10)
    stroke(row, THEME.Stroke2, 1, 0.35)

    local label = Instance.new("TextLabel")
    label.BackgroundTransparency = 1
    label.Position = UDim2.new(0, 12, 0, 0)
    label.Size = UDim2.new(1, -120, 1, 0)
    label.Font = Enum.Font.GothamSemibold
    label.Text = text or "Option"
    label.TextColor3 = THEME.Text
    label.TextSize = 14
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.ZIndex = 5
    label.Parent = row

    local pill = Instance.new("TextButton")
    pill.AutoButtonColor = false
    pill.AnchorPoint = Vector2.new(1, 0.5)
    pill.Position = UDim2.new(1, -8, 0.5, 0)
    pill.Size = UDim2.new(0, 70, 0, 26)
    pill.Font = Enum.Font.GothamBold
    pill.TextSize = 12
    pill.TextColor3 = THEME.Text
    pill.ZIndex = 6
    pill.Parent = row
    corner(pill, 999)
    addButtonSounds(pill)

    local state = false
    local function refresh()
        if state then
            pill.BackgroundColor3 = THEME.ToggleOn
            pill.Text = "ON"
        else
            pill.BackgroundColor3 = THEME.ToggleOff
            pill.Text = "OFF"
        end
    end
    refresh()

    pill.MouseButton1Click:Connect(function()
        state = not state
        refresh()
        if callback then task.spawn(function() callback(state) end) end
    end)

    registerRowForAnimation(row)
    local api = {}
    function api.SetState(v) state = v and true or false refresh() end
    function api.GetState() return state end
    return api
end

local function createActionButton(parent, text, order, callback)
    local btn = Instance.new("TextButton")
    btn.BackgroundColor3 = THEME.Card2
    btn.Size = UDim2.new(1, 0, 0, 34)
    btn.Text = text
    btn.Font = Enum.Font.GothamSemibold
    btn.TextColor3 = THEME.Text
    btn.TextSize = 14
    btn.ZIndex = 4
    btn.LayoutOrder = order
    btn.Parent = parent
    corner(btn, 10)
    stroke(btn, THEME.Stroke2, 1, 0.35)
    addButtonSounds(btn)

    registerRowForAnimation(btn)
    btn.MouseButton1Click:Connect(function() if callback then task.spawn(callback) end end)
    return btn
end

local tabs = {
    {id = "Main", text = "Main"},
    {id = "Aim", text = "Aim"},
    {id = "Target", text = "Target"},
    {id = "Info", text = "Info"},
}

local tabButtons = {}
local tabFrames = {}

local function createTabFrame(name)
    local scroll = Instance.new("ScrollingFrame")
    scroll.Name = name .. "_Page"
    scroll.BackgroundTransparency = 1
    scroll.Size = UDim2.new(1, 0, 1, 0)
    scroll.Position = UDim2.new(0, 0, 0, 0)
    scroll.Visible = false
    scroll.ZIndex = 3
    scroll.Parent = content
    scroll.CanvasSize = UDim2.new(0, 0, 0, 0)
    scroll.ScrollBarThickness = 4
    scroll.ScrollBarImageColor3 = THEME.Stroke1
    scroll.BorderSizePixel = 0
    scroll.ClipsDescendants = true
    scroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
    scroll.ScrollingDirection = Enum.ScrollingDirection.Y
    scroll.CanvasPosition = Vector2.new(0, 0)

    table.insert(allScrollFrames, scroll)

    local innerFrame = Instance.new("Frame")
    innerFrame.Name = "InnerFrame"
    innerFrame.BackgroundTransparency = 1
    innerFrame.Size = UDim2.new(1, -20, 0, 0)
    innerFrame.Position = UDim2.new(0, 10, 0, 10)
    innerFrame.AutomaticSize = Enum.AutomaticSize.Y
    innerFrame.ZIndex = 3
    innerFrame.Parent = scroll

    local layout = Instance.new("UIListLayout", innerFrame)
    layout.FillDirection = Enum.FillDirection.Vertical
    layout.SortOrder = Enum.SortOrder.LayoutOrder
    layout.Padding = UDim.new(0, 6)

    local header = Instance.new("TextLabel")
    header.BackgroundColor3 = THEME.Card2
    header.BorderSizePixel = 0
    header.Size = UDim2.new(1, 0, 0, 36)
    header.Font = Enum.Font.GothamSemibold
    header.Text = "  " .. name
    header.TextColor3 = THEME.Text
    header.TextSize = 15
    header.TextXAlignment = Enum.TextXAlignment.Left
    header.ZIndex = 4
    header.LayoutOrder = 0
    header.Parent = innerFrame
    corner(header, 10)
    stroke(header, THEME.Stroke2, 1, 0.35)
    registerRowForAnimation(header)

    if name == "Main" then
        createToggleRow(innerFrame, "Auto Armor [PC]", 2, function(on) Shared.AutoArmor = on if on then Load_AutoArmor() end end)
        createToggleRow(innerFrame, "Staff Notifier [PC]", 3, function(on) Shared.StaffNotifier = on if on then Load_StaffNotifier() end end)
        createToggleRow(innerFrame, "Instant Stomp", 4, function(on) Shared.InstantStomp = on if on then Load_InstantStomp() end end)
        createToggleRow(innerFrame, "Desync", 5, function(on) Shared.Desync = on if on then Load_Desync() end end)
        createToggleRow(innerFrame, "Disable Desync", 6, function(on) Shared.DisableDesync = on if on then Load_DisableDesync() end end)
        createToggleRow(innerFrame, "Fps Boost", 7, function(on) Shared.FpsBoost = on if on then Load_FpsBoost() end end)
        createToggleRow(innerFrame, "Player Panel [PC]", 8, function(on) Shared.PlayerPanel = on if on then Load_PlayerPanel() end end)
        createToggleRow(innerFrame, "Auto Reload [PC]", 9, function(on) Shared.AutoReload = on if on then Load_AutoReload_S() end end)
        createToggleRow(innerFrame, "Drag Shoot [PC]", 10, function(on) Shared.DragShoot = on if on then Load_DragShoot() end end)

        local spacer = Instance.new("Frame")
        spacer.BackgroundTransparency = 1
        spacer.Size = UDim2.new(1, 0, 0, 10)
        spacer.LayoutOrder = 99
        spacer.Parent = innerFrame

        return scroll
    end

    if name == "Aim" then
        local silentApi, camApi
        local fovBtn, qMethodBtn, statusLabel, methodContainer
        local scriptsLoaded = {FOV = false, QMethod = false}
        
        local function shakeContainer()
            if not methodContainer then return end
            local originalPos = methodContainer.Position
            for i = 1, 6 do
                task.delay(i * 0.04, function()
                    if methodContainer and methodContainer.Parent then
                        methodContainer.Position = UDim2.new(
                            originalPos.X.Scale, 
                            originalPos.X.Offset + (i % 2 == 0 and 6 or -6), 
                            originalPos.Y.Scale, 
                            originalPos.Y.Offset
                        )
                    end
                end)
            end
            task.delay(0.3, function()
                if methodContainer and methodContainer.Parent then
                    methodContainer.Position = originalPos
                end
            end)
        end
        
        local function updateMethodUI()
            if not fovBtn or not qMethodBtn or not statusLabel then return end
            
            if Shared.SilentAimMethod == "FOV" then
                fovBtn.BackgroundColor3 = THEME.MethodActive
                qMethodBtn.BackgroundColor3 = THEME.MethodNone
                statusLabel.Text = "Method: FOV"
                statusLabel.TextColor3 = THEME.MethodActive
            elseif Shared.SilentAimMethod == "QMethod" then
                fovBtn.BackgroundColor3 = THEME.MethodNone
                qMethodBtn.BackgroundColor3 = THEME.MethodActive
                statusLabel.Text = "Method: Q-Lock"
                statusLabel.TextColor3 = THEME.MethodActive
            else
                fovBtn.BackgroundColor3 = THEME.MethodNone
                qMethodBtn.BackgroundColor3 = THEME.MethodNone
                statusLabel.Text = "Select method first!"
                statusLabel.TextColor3 = THEME.Warning
            end
        end
        
        -- Funktion um das richtige Script zu laden basierend auf Methode
        local function loadCurrentMethod()
            if Shared.SilentAimMethod == "FOV" then
                if not scriptsLoaded.FOV then
                    scriptsLoaded.FOV = true
                    Load_SilentAim_FOV()
                end
            elseif Shared.SilentAimMethod == "QMethod" then
                if not scriptsLoaded.QMethod then
                    scriptsLoaded.QMethod = true
                    Load_SilentAim_QMethod()
                end
            end
        end
        
        -- Silent Aim Toggle
        silentApi = createToggleRow(innerFrame, "Silent Aim [PC]", 2, function(on)
            if on then
                if not Shared.SilentAimMethod then
                    silentApi.SetState(false)
                    replaySound(errorSound)
                    shakeContainer()
                    return
                end
                
                Shared.SilentAim = true
                loadCurrentMethod()
                
                if camApi and camApi.GetState() then
                    camApi.SetState(false)
                    Shared.Camlock = false
                end
            else
                Shared.SilentAim = false
            end
        end)

        local spacerBefore = Instance.new("Frame")
        spacerBefore.BackgroundTransparency = 1
        spacerBefore.Size = UDim2.new(1, 0, 0, 8)
        spacerBefore.LayoutOrder = 3
        spacerBefore.Parent = innerFrame

        methodContainer = Instance.new("Frame")
        methodContainer.BackgroundColor3 = THEME.Card2
        methodContainer.BorderSizePixel = 0
        methodContainer.Size = UDim2.new(1, 0, 0, 70)
        methodContainer.ZIndex = 4
        methodContainer.LayoutOrder = 4
        methodContainer.Parent = innerFrame
        corner(methodContainer, 12)
        stroke(methodContainer, THEME.Stroke1, 1.5, 0.2)

        local titleLabel = Instance.new("TextLabel")
        titleLabel.BackgroundTransparency = 1
        titleLabel.Position = UDim2.new(0, 12, 0, 8)
        titleLabel.Size = UDim2.new(0.5, -12, 0, 18)
        titleLabel.Font = Enum.Font.GothamBold
        titleLabel.Text = "Silent Aim Method"
        titleLabel.TextColor3 = THEME.Text
        titleLabel.TextSize = 13
        titleLabel.TextXAlignment = Enum.TextXAlignment.Left
        titleLabel.ZIndex = 5
        titleLabel.Parent = methodContainer

        statusLabel = Instance.new("TextLabel")
        statusLabel.BackgroundTransparency = 1
        statusLabel.Position = UDim2.new(0.5, 0, 0, 8)
        statusLabel.Size = UDim2.new(0.5, -12, 0, 18)
        statusLabel.Font = Enum.Font.GothamSemibold
        statusLabel.Text = "Select method first!"
        statusLabel.TextColor3 = THEME.Warning
        statusLabel.TextSize = 11
        statusLabel.TextXAlignment = Enum.TextXAlignment.Right
        statusLabel.ZIndex = 5
        statusLabel.Parent = methodContainer

        local btnContainer = Instance.new("Frame")
        btnContainer.BackgroundTransparency = 1
        btnContainer.Position = UDim2.new(0, 10, 0, 34)
        btnContainer.Size = UDim2.new(1, -20, 0, 28)
        btnContainer.ZIndex = 5
        btnContainer.Parent = methodContainer

        local btnLayout = Instance.new("UIListLayout", btnContainer)
        btnLayout.FillDirection = Enum.FillDirection.Horizontal
        btnLayout.SortOrder = Enum.SortOrder.LayoutOrder
        btnLayout.Padding = UDim.new(0, 10)
        btnLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

        fovBtn = Instance.new("TextButton")
        fovBtn.BackgroundColor3 = THEME.MethodNone
        fovBtn.Size = UDim2.new(0.45, 0, 1, 0)
        fovBtn.Text = "FOV Method"
        fovBtn.Font = Enum.Font.GothamBold
        fovBtn.TextColor3 = THEME.Text
        fovBtn.TextSize = 12
        fovBtn.ZIndex = 6
        fovBtn.LayoutOrder = 1
        fovBtn.Parent = btnContainer
        corner(fovBtn, 8)
        addButtonSounds(fovBtn)

        fovBtn.MouseButton1Click:Connect(function()
            -- Setze Methode auf FOV
            Shared.SilentAimMethod = "FOV"
            updateMethodUI()
            
            -- NUR laden wenn Silent Aim AN ist
            if Shared.SilentAim then
                loadCurrentMethod()
            end
        end)

        qMethodBtn = Instance.new("TextButton")
        qMethodBtn.BackgroundColor3 = THEME.MethodNone
        qMethodBtn.Size = UDim2.new(0.45, 0, 1, 0)
        qMethodBtn.Text = "Q Method"
        qMethodBtn.Font = Enum.Font.GothamBold
        qMethodBtn.TextColor3 = THEME.Text
        qMethodBtn.TextSize = 12
        qMethodBtn.ZIndex = 6
        qMethodBtn.LayoutOrder = 2
        qMethodBtn.Parent = btnContainer
        corner(qMethodBtn, 8)
        addButtonSounds(qMethodBtn)

        qMethodBtn.MouseButton1Click:Connect(function()
            -- Setze Methode auf QMethod
            Shared.SilentAimMethod = "QMethod"
            updateMethodUI()
            
            -- NUR laden wenn Silent Aim AN ist
            if Shared.SilentAim then
                loadCurrentMethod()
            end
        end)

        registerRowForAnimation(methodContainer)
        updateMethodUI()

        local spacerAfter = Instance.new("Frame")
        spacerAfter.BackgroundTransparency = 1
        spacerAfter.Size = UDim2.new(1, 0, 0, 8)
        spacerAfter.LayoutOrder = 5
        spacerAfter.Parent = innerFrame

        createToggleRow(innerFrame, "TriggerBot [PC]", 6, function(on) Shared.TriggerBot = on if on then Load_TriggerBot() end end)

        camApi = createToggleRow(innerFrame, "Camlock [PC]", 7, function(on)
            Shared.Camlock = on
            if on then
                Load_Camlock()
                if silentApi and silentApi.GetState() then
                    silentApi.SetState(false)
                    Shared.SilentAim = false
                end
            end
        end)

        local spacer = Instance.new("Frame")
        spacer.BackgroundTransparency = 1
        spacer.Size = UDim2.new(1, 0, 0, 10)
        spacer.LayoutOrder = 99
        spacer.Parent = innerFrame

        return scroll
    end

    if name == "Target" then
        local searchBoxTarget, statusLabel, avatarInner, nameBig, nameSmall

        local function trunc(str, max) if not str then return "" end if #str <= max then return str end return string.sub(str, 1, max - 3) .. "..." end

        local function findPlayer(query)
            if not query or query == "" then return nil end
            query = string.lower(query)
            local best
            for _, plr in ipairs(Players:GetPlayers()) do
                if plr ~= lp then
                    local un = string.lower(plr.Name)
                    local dn = string.lower(plr.DisplayName or plr.Name)
                    if un == query or dn == query then return plr end
                    if (string.find(un, query, 1, true) or string.find(dn, query, 1, true)) and not best then best = plr end
                end
            end
            return best
        end

        local function setTarget(plr)
            if not plr then
                Shared.TargetUsername = nil
                if searchBoxTarget then searchBoxTarget.Text = "" end
                if statusLabel then statusLabel.Text = "No target" end
                if nameBig then nameBig.Text = "No Target" end
                if nameSmall then nameSmall.Text = "@none" end
                if avatarInner then avatarInner.Image = "" end
                return
            end
            Shared.TargetUsername = plr.Name
            local uname = plr.Name
            local dname = plr.DisplayName or plr.Name
            if searchBoxTarget then searchBoxTarget.Text = uname end
            if statusLabel then statusLabel.Text = trunc(dname, 16) .. " [@" .. trunc(uname, 10) .. "]" end
            if nameBig then nameBig.Text = trunc(dname, 18) end
            if nameSmall then nameSmall.Text = "@" .. trunc(uname, 14) end
            if avatarInner then
                local ok2, img2 = pcall(function() return Players:GetUserThumbnailAsync(plr.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size100x100) end)
                if ok2 and img2 then avatarInner.Image = img2 end
            end
        end

        local controlsRow = Instance.new("Frame")
        controlsRow.BackgroundColor3 = THEME.Card
        controlsRow.Size = UDim2.new(1, 0, 0, 36)
        controlsRow.ZIndex = 4
        controlsRow.LayoutOrder = 2
        controlsRow.Parent = innerFrame
        corner(controlsRow, 10)
        stroke(controlsRow, THEME.Stroke2, 1, 0.35)
        registerRowForAnimation(controlsRow)

        local controlsLayout = Instance.new("UIListLayout", controlsRow)
        controlsLayout.FillDirection = Enum.FillDirection.Horizontal
        controlsLayout.SortOrder = Enum.SortOrder.LayoutOrder
        controlsLayout.Padding = UDim.new(0, 4)
        controlsLayout.VerticalAlignment = Enum.VerticalAlignment.Center
        padding(controlsRow, 6, 6, 0, 0)

        local gotoBtn = Instance.new("TextButton")
        gotoBtn.BackgroundColor3 = THEME.Card2
        gotoBtn.Size = UDim2.new(0, 50, 0, 26)
        gotoBtn.Text = "Goto"
        gotoBtn.Font = Enum.Font.GothamBold
        gotoBtn.TextColor3 = THEME.Text
        gotoBtn.TextSize = 11
        gotoBtn.ZIndex = 5
        gotoBtn.LayoutOrder = 1
        gotoBtn.Parent = controlsRow
        corner(gotoBtn, 6)
        addButtonSounds(gotoBtn)

        gotoBtn.MouseButton1Click:Connect(function() Shared.GotoTarget = true Load_Target() end)

        local function miniToggle(parent, txt, ord, cb)
            local btn = Instance.new("TextButton")
            btn.BackgroundColor3 = THEME.ToggleOff
            btn.Size = UDim2.new(0, 60, 0, 26)
            btn.Text = txt
            btn.Font = Enum.Font.GothamBold
            btn.TextColor3 = THEME.Text
            btn.TextSize = 10
            btn.ZIndex = 5
            btn.LayoutOrder = ord
            btn.Parent = parent
            corner(btn, 6)
            addButtonSounds(btn)
            local state = false
            btn.MouseButton1Click:Connect(function()
                state = not state
                btn.BackgroundColor3 = state and THEME.ToggleOn or THEME.ToggleOff
                if cb then task.spawn(function() cb(state) end) end
            end)
            return btn
        end

        miniToggle(controlsRow, "View", 2, function(on) Shared.ViewTarget = on Load_Target() end)
        miniToggle(controlsRow, "HL", 3, function(on) Shared.HighlightTarget = on Load_Target() end)
        miniToggle(controlsRow, "Katana", 4, function(on) Shared.AutoKatanaKill = on Load_Target() end)
        miniToggle(controlsRow, "Fling", 5, function(on) Shared.Fling = on Load_Target() end)

        local searchRow = Instance.new("Frame")
        searchRow.BackgroundColor3 = THEME.Card
        searchRow.Size = UDim2.new(1, 0, 0, 34)
        searchRow.ZIndex = 4
        searchRow.LayoutOrder = 3
        searchRow.Parent = innerFrame
        corner(searchRow, 10)
        stroke(searchRow, THEME.Stroke2, 1, 0.35)
        registerRowForAnimation(searchRow)

        searchBoxTarget = Instance.new("TextBox")
        searchBoxTarget.BackgroundTransparency = 1
        searchBoxTarget.Position = UDim2.new(0, 10, 0, 0)
        searchBoxTarget.Size = UDim2.new(1, -60, 1, 0)
        searchBoxTarget.Font = Enum.Font.Gotham
        searchBoxTarget.PlaceholderText = "Search player..."
        searchBoxTarget.Text = ""
        searchBoxTarget.TextColor3 = THEME.Text
        searchBoxTarget.PlaceholderColor3 = THEME.SubText
        searchBoxTarget.TextSize = 13
        searchBoxTarget.ClearTextOnFocus = false
        searchBoxTarget.ZIndex = 5
        searchBoxTarget.Parent = searchRow

        local searchGo = Instance.new("TextButton")
        searchGo.BackgroundColor3 = THEME.Card2
        searchGo.AnchorPoint = Vector2.new(1, 0.5)
        searchGo.Position = UDim2.new(1, -6, 0.5, 0)
        searchGo.Size = UDim2.new(0, 40, 0, 24)
        searchGo.Font = Enum.Font.GothamBold
        searchGo.Text = "GO"
        searchGo.TextColor3 = THEME.Text
        searchGo.TextSize = 11
        searchGo.ZIndex = 5
        searchGo.Parent = searchRow
        corner(searchGo, 6)
        addButtonSounds(searchGo)

        local avatarCard = Instance.new("Frame")
        avatarCard.BackgroundColor3 = THEME.Card
        avatarCard.Size = UDim2.new(1, 0, 0, 56)
        avatarCard.ZIndex = 4
        avatarCard.LayoutOrder = 4
        avatarCard.Parent = innerFrame
        corner(avatarCard, 10)
        stroke(avatarCard, THEME.Stroke2, 1, 0.35)
        registerRowForAnimation(avatarCard)

        avatarInner = Instance.new("ImageLabel")
        avatarInner.BackgroundColor3 = THEME.BgMain
        avatarInner.Size = UDim2.new(0, 44, 0, 44)
        avatarInner.Position = UDim2.new(0, 6, 0.5, -22)
        avatarInner.BorderSizePixel = 0
        avatarInner.ZIndex = 5
        avatarInner.Parent = avatarCard
        corner(avatarInner, 999)

        nameBig = Instance.new("TextLabel")
        nameBig.BackgroundTransparency = 1
        nameBig.Position = UDim2.new(0, 58, 0.5, -14)
        nameBig.Size = UDim2.new(1, -66, 0, 16)
        nameBig.Font = Enum.Font.GothamSemibold
        nameBig.TextColor3 = THEME.Text
        nameBig.TextSize = 14
        nameBig.TextXAlignment = Enum.TextXAlignment.Left
        nameBig.ZIndex = 5
        nameBig.Text = "No Target"
        nameBig.Parent = avatarCard

        nameSmall = Instance.new("TextLabel")
        nameSmall.BackgroundTransparency = 1
        nameSmall.Position = UDim2.new(0, 58, 0.5, 4)
        nameSmall.Size = UDim2.new(1, -66, 0, 14)
        nameSmall.Font = Enum.Font.Gotham
        nameSmall.TextColor3 = THEME.SubText
        nameSmall.TextSize = 12
        nameSmall.TextXAlignment = Enum.TextXAlignment.Left
        nameSmall.ZIndex = 5
        nameSmall.Text = "@none"
        nameSmall.Parent = avatarCard

        statusLabel = Instance.new("TextLabel")
        statusLabel.BackgroundTransparency = 1
        statusLabel.Size = UDim2.new(1, 0, 0, 18)
        statusLabel.Font = Enum.Font.Gotham
        statusLabel.TextColor3 = THEME.SubText
        statusLabel.TextSize = 11
        statusLabel.TextXAlignment = Enum.TextXAlignment.Left
        statusLabel.ZIndex = 4
        statusLabel.LayoutOrder = 5
        statusLabel.Text = "No target"
        statusLabel.Parent = innerFrame
        registerRowForAnimation(statusLabel)

        local copyRow = Instance.new("Frame")
        copyRow.BackgroundTransparency = 1
        copyRow.Size = UDim2.new(1, 0, 0, 28)
        copyRow.ZIndex = 4
        copyRow.LayoutOrder = 6
        copyRow.Parent = innerFrame
        registerRowForAnimation(copyRow)

        local copyLayout = Instance.new("UIListLayout", copyRow)
        copyLayout.FillDirection = Enum.FillDirection.Horizontal
        copyLayout.SortOrder = Enum.SortOrder.LayoutOrder
        copyLayout.Padding = UDim.new(0, 6)

        local function safeClipboard(text) if typeof(setclipboard) == "function" then pcall(setclipboard, text) end end

        local copyUser = Instance.new("TextButton")
        copyUser.BackgroundColor3 = THEME.Card2
        copyUser.Size = UDim2.new(0.48, 0, 1, 0)
        copyUser.Text = "Copy User"
        copyUser.Font = Enum.Font.GothamSemibold
        copyUser.TextColor3 = THEME.Text
        copyUser.TextSize = 11
        copyUser.ZIndex = 5
        copyUser.LayoutOrder = 1
        copyUser.Parent = copyRow
        corner(copyUser, 6)
        addButtonSounds(copyUser)
        copyUser.MouseButton1Click:Connect(function()
            if Shared.TargetUsername then safeClipboard(Shared.TargetUsername) statusLabel.Text = "Copied!" end
        end)

        local copyDisp = Instance.new("TextButton")
        copyDisp.BackgroundColor3 = THEME.Card2
        copyDisp.Size = UDim2.new(0.48, 0, 1, 0)
        copyDisp.Text = "Copy Display"
        copyDisp.Font = Enum.Font.GothamSemibold
        copyDisp.TextColor3 = THEME.Text
        copyDisp.TextSize = 11
        copyDisp.ZIndex = 5
        copyDisp.LayoutOrder = 2
        copyDisp.Parent = copyRow
        corner(copyDisp, 6)
        addButtonSounds(copyDisp)
        copyDisp.MouseButton1Click:Connect(function()
            local plr = Players:FindFirstChild(Shared.TargetUsername or "")
            if plr then safeClipboard(plr.DisplayName or plr.Name) statusLabel.Text = "Copied!" end
        end)

        local spacer = Instance.new("Frame")
        spacer.BackgroundTransparency = 1
        spacer.Size = UDim2.new(1, 0, 0, 10)
        spacer.LayoutOrder = 99
        spacer.Parent = innerFrame

        local function performSearch()
            local txt = searchBoxTarget.Text
            local plr = findPlayer(txt)
            if plr then setTarget(plr) else statusLabel.Text = "Not found: " .. txt end
        end

        searchGo.MouseButton1Click:Connect(performSearch)
        searchBoxTarget.FocusLost:Connect(function(enter) if enter then performSearch() end end)

        setTarget(nil)
        return scroll
    end

    if name == "Info" then
        local infoText = Instance.new("TextLabel")
        infoText.BackgroundColor3 = THEME.Card
        infoText.Size = UDim2.new(1, 0, 0, 60)
        infoText.Font = Enum.Font.Gotham
        infoText.TextColor3 = THEME.Text
        infoText.TextSize = 12
        infoText.TextWrapped = true
        infoText.TextXAlignment = Enum.TextXAlignment.Left
        infoText.TextYAlignment = Enum.TextYAlignment.Top
        infoText.ZIndex = 4
        infoText.LayoutOrder = 2
        infoText.Text = "Report bugs in my discord server. More features coming soon! This is beta."
        infoText.Parent = innerFrame
        corner(infoText, 10)
        stroke(infoText, THEME.Stroke2, 1, 0.35)
        padding(infoText, 10, 10, 10, 10)
        registerRowForAnimation(infoText)

        createActionButton(innerFrame, "Copy Discord Link", 3, function()
            if typeof(setclipboard) == "function" then pcall(setclipboard, DISCORD_INVITE) end
        end)

        local spacer = Instance.new("Frame")
        spacer.BackgroundTransparency = 1
        spacer.Size = UDim2.new(1, 0, 0, 10)
        spacer.LayoutOrder = 99
        spacer.Parent = innerFrame

        return scroll
    end

    return scroll
end

for i, t in ipairs(tabs) do
    local btn = Instance.new("TextButton")
    btn.Name = t.id .. "_Tab"
    btn.BackgroundColor3 = THEME.TabIdle
    btn.BorderSizePixel = 0
    btn.Size = UDim2.new(1, 0, 0, 32)
    btn.Font = Enum.Font.GothamSemibold
    btn.Text = "  " .. t.text
    btn.TextColor3 = THEME.Text
    btn.TextSize = 14
    btn.TextXAlignment = Enum.TextXAlignment.Left
    btn.LayoutOrder = i
    btn.ZIndex = 4
    btn.Parent = tabsContainer
    corner(btn, 10)
    addButtonSounds(btn)
    tabButtons[t.id] = btn
    tabFrames[t.id] = createTabFrame(t.id)
end

local function switchTab(id)
    for name, frame in pairs(tabFrames) do frame.Visible = (name == id) end
    for name, btn in pairs(tabButtons) do btn.BackgroundColor3 = (name == id) and THEME.TabActive or THEME.TabIdle end
end

for id, btn in pairs(tabButtons) do btn.MouseButton1Click:Connect(function() switchTab(id) end) end
switchTab("Main")

do
    local dragging, dragInput, dragStart, startPos
    local function update(input)
        local delta = input.Position - dragStart
        main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
    topBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = main.Position
            input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then dragging = false end end)
        end
    end)
    topBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then dragInput = input end
    end)
    UserInputService.InputChanged:Connect(function(input) if input == dragInput and dragging then update(input) end end)
end

local minimized = false
miniBtn.MouseButton1Click:Connect(function()
    minimized = not minimized
    if minimized then
        inner.Visible = false
        main.Size = UDim2.new(NORMAL_SIZE.X.Scale, NORMAL_SIZE.X.Offset, 0, 74)
    else
        inner.Visible = true
        main.Size = NORMAL_SIZE
    end
end)

closeBtn.MouseButton1Click:Connect(function() DisableAllScripts() gui:Destroy() end)

task.spawn(function()
    while not getgenv().SchmecktIntroFinished do task.wait() end

    local openSound = Instance.new("Sound")
    openSound.SoundId = GUI_OPEN_SOUND
    openSound.Volume = 2
    openSound.Parent = SoundService
    openSound:Play()
    task.delay(3, function() openSound:Destroy() end)

    for _, frame in pairs(tabFrames) do
        frame.CanvasPosition = Vector2.new(0, 0)
    end

    main.Size = UDim2.new(0, 0, 0, 0)
    main.Visible = true
    TweenService:Create(main, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
        Size = NORMAL_SIZE
    }):Play()

    task.wait(0.5)

    for i, row in ipairs(allRows) do
        task.delay(i * 0.04, function()
            if not row or not row.Parent then return end
            if row:IsA("Frame") then
                TweenService:Create(row, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                    BackgroundTransparency = 0
                }):Play()
            elseif row:IsA("TextButton") then
                TweenService:Create(row, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                    BackgroundTransparency = 0,
                    TextTransparency = 0
                }):Play()
            elseif row:IsA("TextLabel") then
                TweenService:Create(row, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                    TextTransparency = 0
                }):Play()
            end

            for _, child in ipairs(row:GetDescendants()) do
                if child:IsA("TextLabel") then
                    TweenService:Create(child, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                        TextTransparency = 0
                    }):Play()
                elseif child:IsA("TextButton") then
                    TweenService:Create(child, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                        BackgroundTransparency = 0,
                        TextTransparency = 0
                    }):Play()
                elseif child:IsA("ImageLabel") then
                    TweenService:Create(child, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                        ImageTransparency = 0
                    }):Play()
                end
            end
        end)
    end

    task.delay(#allRows * 0.04 + 0.3, function()
        for _, frame in pairs(tabFrames) do
            frame.CanvasPosition = Vector2.new(0, 0)
        end
    end)
end)
