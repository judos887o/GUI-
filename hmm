local TweenService = game:GetService("TweenService")
local SoundService = game:GetService("SoundService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local HttpService = game:GetService("HttpService")
local Stats = game:GetService("Stats")

local lp = Players.LocalPlayer
local LOGO_ASSET = "rbxassetid://121759217057084"

getgenv().SchmecktHubPC = getgenv().SchmecktHubPC or {}
local Shared = getgenv().SchmecktHubPC

Shared.TotalExecutions = (Shared.TotalExecutions or 0) + 1
Shared.AutoArmor = Shared.AutoArmor or false
Shared.StaffNotifier = Shared.StaffNotifier or false
Shared.TriggerBot = Shared.TriggerBot or false
Shared.Camlock = Shared.Camlock or false
Shared.SilentAim = Shared.SilentAim or false
Shared.SilentAimMethod = Shared.SilentAimMethod
Shared.Desync = Shared.Desync or false
Shared.DisableDesync = Shared.DisableDesync or false
Shared.FpsBoost = Shared.FpsBoost or false
Shared.AutoReload = Shared.AutoReload or false
Shared.PlayerPanel = Shared.PlayerPanel or false
Shared.DragShoot = Shared.DragShoot or false
Shared.TargetUsername = Shared.TargetUsername
Shared.AutoKatanaKill = Shared.AutoKatanaKill or false
Shared.Fling = Shared.Fling or false
Shared.HighlightTarget = Shared.HighlightTarget or false
Shared.ViewTarget = Shared.ViewTarget or false
Shared.GotoTarget = Shared.GotoTarget or false
Shared.InstantStomp = Shared.InstantStomp or false
Shared.OPKill = Shared.OPKill or false
Shared.Aura = Shared.Aura or false
Shared.AntiFling = Shared.AntiFling or false
Shared.Platform = Shared.Platform or "PC"
Shared.Connections = Shared.Connections or {}

local CONFIG_DIR = "SchmecktHub"
local CONFIG_FILE = CONFIG_DIR .. "/config.json"
local FS_OK = (typeof(isfile) == "function" and typeof(writefile) == "function" and typeof(readfile) == "function" and typeof(makefolder) == "function" and typeof(isfolder) == "function")

local function serializeConfig()
    return {
        Platform = Shared.Platform,
        SilentAimMethod = Shared.SilentAimMethod,
        Toggles = {
            AutoArmor = Shared.AutoArmor,
            StaffNotifier = Shared.StaffNotifier,
            TriggerBot = Shared.TriggerBot,
            Camlock = Shared.Camlock,
            SilentAim = Shared.SilentAim,
            Desync = Shared.Desync,
            DisableDesync = Shared.DisableDesync,
            FpsBoost = Shared.FpsBoost,
            AutoReload = Shared.AutoReload,
            PlayerPanel = Shared.PlayerPanel,
            DragShoot = Shared.DragShoot,
            AutoKatanaKill = Shared.AutoKatanaKill,
            Fling = Shared.Fling,
            HighlightTarget = Shared.HighlightTarget,
            ViewTarget = Shared.ViewTarget,
            InstantStomp = Shared.InstantStomp,
            OPKill = Shared.OPKill,
            Aura = Shared.Aura,
            AntiFling = Shared.AntiFling,
        }
    }
end

local function applyConfig(cfg)
    if not cfg then return end
    Shared.Platform = cfg.Platform or Shared.Platform
    Shared.SilentAimMethod = cfg.SilentAimMethod
    local T = cfg.Toggles or {}
    for k, v in pairs(T) do
        if type(v) == "boolean" and Shared[k] ~= nil then
            Shared[k] = v
        end
    end
end

function Shared.SaveConfig()
    task.spawn(function()
        pcall(function()
            local json = HttpService:JSONEncode(serializeConfig())
            if FS_OK then
                if not isfolder(CONFIG_DIR) then makefolder(CONFIG_DIR) end
                writefile(CONFIG_FILE, json)
            else
                getgenv()._SchmecktLastCfg = json
            end
        end)
    end)
end

local function LoadConfig()
    local raw
    if FS_OK and isfile(CONFIG_FILE) then
        raw = readfile(CONFIG_FILE)
    elseif getgenv()._SchmecktLastCfg then
        raw = getgenv()._SchmecktLastCfg
    end
    if raw then
        local ok, data = pcall(function() return HttpService:JSONDecode(raw) end)
        if ok and data then applyConfig(data) end
    end
end

LoadConfig()

local function safeLoad(url)
    task.spawn(function()
        pcall(function() loadstring(game:HttpGet(url, true))() end)
    end)
end

local function Load_AutoArmor() safeLoad("https://raw.githubusercontent.com/judos887o/auto-armor/main/ar") end
local function Load_StaffNotifier() safeLoad("https://raw.githubusercontent.com/judos887o/staff-notifie/main/a") end
local function Load_TriggerBot() safeLoad("https://raw.githubusercontent.com/judos887o/TRIGGERBOT-pc/main/trigger") end
local function Load_Camlock() safeLoad("https://raw.githubusercontent.com/judos887o/camlock-pc/main/camlcok") end
local function Load_SilentAim_FOV() safeLoad("https://raw.githubusercontent.com/judos887o/silent-aim-FOV-METHOD/main/teat") end
local function Load_SilentAim_QMethod() safeLoad("https://raw.githubusercontent.com/judos887o/Silent-Aim/main/silent") end
local function Load_PlayerPanel() safeLoad("https://raw.githubusercontent.com/judos887o/PlayerGui-Da-hood-script-schmeckt/main/teat") end
local function Load_AutoReload_S() safeLoad("https://raw.githubusercontent.com/judos887o/Auto-reload-da-hood-schmeckt/main/teat") end
local function Load_DragShoot() safeLoad("https://raw.githubusercontent.com/judos887o/drag-shoot-da-hood-schmeckt/main/teat") end
local function Load_Desync() safeLoad("https://raw.githubusercontent.com/judos887o/desync-schmeckt/main/teat") end
local function Load_DisableDesync() safeLoad("https://raw.githubusercontent.com/judos887o/disdes/main/teat") end
local function Load_FpsBoost() safeLoad("https://raw.githubusercontent.com/judos887o/fps-nuke/main/teat") end
local function Load_Target() safeLoad("https://raw.githubusercontent.com/judos887o/target-schmeckt/main/teat") end
local function Load_SilentAim_Mobile_Remote() safeLoad("https://raw.githubusercontent.com/judos887o/silent-aim-mobile/main/teat") end
local function Load_Camlock_Mobile() safeLoad("https://raw.githubusercontent.com/judos887o/camnlock-mobiel/main/teat") end
local function Load_InstantStomp() safeLoad("https://raw.githubusercontent.com/judos887o/momenzinstants/main/teats") end
local function Load_AntiFling() safeLoad("https://raw.githubusercontent.com/judos887o/ANTI-FL/main/te") end

local function Stop_InstantStomp()
    local S = getgenv().SchmecktHubPC
    if S and S.InstantStomp_Destroy then pcall(S.InstantStomp_Destroy) S.InstantStomp_Destroy = nil end
    if S and S.Connections then
        if S.Connections["InstantStompCore"] then for _, c in pairs(S.Connections["InstantStompCore"]) do pcall(function() c:Disconnect() end) end S.Connections["InstantStompCore"] = nil end
    end
    local g = CoreGui:FindFirstChild("Schmeckt_InstantStomp_UI") if g then g:Destroy() end
    if lp and lp:FindFirstChild("PlayerGui") then local pgUI = lp.PlayerGui:FindFirstChild("Schmeckt_InstantStomp_UI") if pgUI then pgUI:Destroy() end end
    local ring = Workspace:FindFirstChild("Schmeckt_InstantStomp_Ring") if ring then ring:Destroy() end
end

local function Stop_SilentAim_All()
    if getgenv().SilentAim_Q_Destroy then pcall(getgenv().SilentAim_Q_Destroy) end
    if getgenv().SilentAim_FOV_Destroy then pcall(getgenv().SilentAim_FOV_Destroy) end
    if Shared and Shared.Connections then
        for key, list in pairs(Shared.Connections) do
            if tostring(key):lower():find("silent") then
                for _, c in ipairs(list) do pcall(function() c:Disconnect() end) end
                Shared.Connections[key] = nil
            end
        end
    end
    local kill = {"Schmeckt_SilentAim_UI","Schmeckt_SilentAim_FOV_UI","SchmecktSilentAim","SilentStatusQ"}
    for _, n in ipairs(kill) do local g = CoreGui:FindFirstChild(n) if g then g:Destroy() end end
    if lp and lp:FindFirstChild("PlayerGui") then
        local pg = lp.PlayerGui
        for _, n in ipairs(kill) do local g2 = pg:FindFirstChild(n) if g2 then g2:Destroy() end end
    end
end

local function Stop_Camlock_PC()
    if CoreGui:FindFirstChild("SchmecktCamlock") then CoreGui.SchmecktCamlock:Destroy() end
end

local function Stop_Camlock_Mobile()
    local M = getgenv().SchmecktHubMobile
    if M and M._CamlockGUI then pcall(function() M._CamlockGUI:Destroy() end) M._CamlockGUI = nil end
end

local function Stop_AntiFling_External()
    Shared.AntiFling = false
end

local function Load_SilentAim_ByMethod()
    local m = Shared.SilentAimMethod
    if m == "QMethod" then Stop_SilentAim_All() Load_SilentAim_QMethod() return end
    if m == "FOV" then Stop_SilentAim_All() Load_SilentAim_FOV() return end
    if m == "MobileMethod" then Stop_SilentAim_All() Load_SilentAim_Mobile_Remote() return end
end

local function DisableAllScripts()
    Shared.AutoArmor = false
    Shared.StaffNotifier = false
    Shared.TriggerBot = false
    Shared.Camlock = false
    Shared.SilentAim = false
    Shared.Desync = false
    Shared.DisableDesync = false
    Shared.FpsBoost = false
    Shared.AutoReload = false
    Shared.PlayerPanel = false
    Shared.DragShoot = false
    Shared.AutoKatanaKill = false
    Shared.Fling = false
    Shared.HighlightTarget = false
    Shared.ViewTarget = false
    Shared.GotoTarget = false
    Shared.InstantStomp = false
    Shared.OPKill = false
    Shared.Aura = false
    Shared.AntiFling = false
    Stop_InstantStomp()
    Stop_SilentAim_All()
    Stop_Camlock_PC()
    Stop_Camlock_Mobile()
    Stop_AntiFling_External()
end

local function MainUI()
    if CoreGui:FindFirstChild("SchmecktUI") then CoreGui.SchmecktUI:Destroy() end

    local SCALE = 1
    if Shared.Platform == "Mobile" or UserInputService.TouchEnabled then
        SCALE = 1 / 1.5
    end

    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "SchmecktUI"
    ScreenGui.ResetOnSpawn = false
    ScreenGui.Parent = CoreGui
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

    local Theme = {
        Background = Color3.fromRGB(15, 5, 5),
        Accent = Color3.fromRGB(220, 0, 0),
        ToggleOn = Color3.fromRGB(200, 0, 0),
        ToggleOff = Color3.fromRGB(45, 10, 10),
        Text = Color3.fromRGB(255, 255, 255),
        SubText = Color3.fromRGB(255, 150, 150),
        Stroke = Color3.fromRGB(80, 0, 0)
    }

    local function scaleUDim(x, y) return UDim2.new(0, x * SCALE, 0, y * SCALE) end
    local function scaleSize(s) return math.floor(s * SCALE) end

    local BottomBar = Instance.new("Frame")
    BottomBar.Name = "BottomBar"
    BottomBar.Size = scaleUDim(500, 55)
    BottomBar.Position = UDim2.new(0.5, -(250 * SCALE), 1, -(70 * SCALE))
    BottomBar.BackgroundColor3 = Theme.Background
    BottomBar.BorderSizePixel = 0
    BottomBar.Parent = ScreenGui
    local UICorner = Instance.new("UICorner"); UICorner.CornerRadius = UDim.new(0, 10 * SCALE); UICorner.Parent = BottomBar
    local UIStroke = Instance.new("UIStroke"); UIStroke.Color = Theme.Stroke; UIStroke.Thickness = 1 * SCALE; UIStroke.Parent = BottomBar

    local Logo = Instance.new("ImageLabel")
    Logo.Name = "Logo"
    Logo.Size = scaleUDim(35, 35)
    Logo.Position = UDim2.new(0, 12 * SCALE, 0.5, -(17.5 * SCALE))
    Logo.BackgroundColor3 = Color3.fromRGB(20, 0, 0)
    Logo.Image = LOGO_ASSET
    Logo.Parent = BottomBar
    Instance.new("UICorner", Logo).CornerRadius = UDim.new(0, 8 * SCALE)

    local Title = Instance.new("TextLabel")
    Title.Name = "Title"
    Title.Size = scaleUDim(250, 20)
    Title.Position = UDim2.new(0, 58 * SCALE, 0, 8 * SCALE)
    Title.BackgroundTransparency = 1
    Title.Text = "Schmeckt + Shadowpepper"
    Title.Font = Enum.Font.GothamBlack
    Title.TextSize = scaleSize(16)
    Title.TextColor3 = Theme.Accent
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.Parent = BottomBar

    local SubTitle = Instance.new("TextLabel")
    SubTitle.Name = "SubTitle"
    SubTitle.Size = scaleUDim(300, 15)
    SubTitle.Position = UDim2.new(0, 58 * SCALE, 0, 28 * SCALE)
    SubTitle.BackgroundTransparency = 1
    SubTitle.Text = "Type: " .. Shared.Platform .. " (developed by schmeckt)"
    SubTitle.Font = Enum.Font.GothamBold
    SubTitle.TextSize = scaleSize(11)
    SubTitle.TextColor3 = Theme.SubText
    SubTitle.TextXAlignment = Enum.TextXAlignment.Left
    SubTitle.Parent = BottomBar

    local StatsLabel = Instance.new("TextLabel")
    StatsLabel.Name = "Stats"
    StatsLabel.Size = UDim2.new(0, 140 * SCALE, 1, 0)
    StatsLabel.Position = UDim2.new(0, 365 * SCALE, 0, 0)
    StatsLabel.BackgroundTransparency = 1
    StatsLabel.Text = "FPS: ..\nPing: .."
    StatsLabel.Font = Enum.Font.GothamBold
    StatsLabel.TextSize = scaleSize(11)
    StatsLabel.TextColor3 = Theme.Text
    StatsLabel.TextXAlignment = Enum.TextXAlignment.Left
    StatsLabel.Parent = BottomBar

    task.spawn(function()
        while ScreenGui.Parent do
            local fps = math.floor(1 / (RunService.RenderStepped:Wait() + 0.001))
            local ping = 0
            pcall(function() ping = math.floor(Stats.Network.ServerStatsItem["Data Ping"]:GetValue()) end)
            if StatsLabel and StatsLabel.Parent then
                StatsLabel.Text = "FPS: " .. fps .. "\nPing: " .. ping .. "ms"
            end
            task.wait(1)
        end
    end)

    local HubFrame = Instance.new("Frame")
    HubFrame.Name = "HubFrame"
    HubFrame.Size = scaleUDim(260, 420)
    HubFrame.Position = UDim2.new(1, -(280 * SCALE), 0.5, -(210 * SCALE))
    HubFrame.BackgroundColor3 = Color3.fromRGB(15, 5, 5)
    HubFrame.BackgroundTransparency = 0.05
    HubFrame.BorderSizePixel = 0
    HubFrame.Parent = ScreenGui
    local HubCorner = Instance.new("UICorner"); HubCorner.CornerRadius = UDim.new(0, 12 * SCALE); HubCorner.Parent = HubFrame
    local HubStroke = Instance.new("UIStroke"); HubStroke.Color = Theme.Accent; HubStroke.Transparency = 0.5; HubStroke.Thickness = 1.5 * SCALE; HubStroke.Parent = HubFrame

    local HeaderText = Instance.new("TextLabel")
    HeaderText.Size = UDim2.new(1, -(24 * SCALE), 0, 30 * SCALE)
    HeaderText.Position = UDim2.new(0, 12 * SCALE, 0, 10 * SCALE)
    HeaderText.BackgroundTransparency = 1
    HeaderText.Text = "FEATURES"
    HeaderText.Font = Enum.Font.GothamBlack
    HeaderText.TextSize = scaleSize(11)
    HeaderText.TextColor3 = Theme.SubText
    HeaderText.TextXAlignment = Enum.TextXAlignment.Left
    HeaderText.Parent = HubFrame

    local Scroll = Instance.new("ScrollingFrame")
    Scroll.Name = "Scroll"
    Scroll.Size = UDim2.new(1, 0, 1, -(50 * SCALE))
    Scroll.Position = UDim2.new(0, 0, 0, 40 * SCALE)
    Scroll.BackgroundTransparency = 1
    Scroll.BorderSizePixel = 0
    Scroll.ScrollBarThickness = 2 * SCALE
    Scroll.ScrollBarImageColor3 = Theme.Accent
    Scroll.Parent = HubFrame

    local UIList = Instance.new("UIListLayout")
    UIList.Parent = Scroll
    UIList.SortOrder = Enum.SortOrder.LayoutOrder
    UIList.Padding = UDim.new(0, 2 * SCALE)

    local function CreateSection(text)
        local Sec = Instance.new("TextLabel")
        Sec.Size = scaleUDim(260, 25)
        Sec.BackgroundTransparency = 1
        Sec.Text = "  " .. text
        Sec.TextColor3 = Theme.Accent
        Sec.Font = Enum.Font.GothamBlack
        Sec.TextSize = scaleSize(10)
        Sec.TextXAlignment = Enum.TextXAlignment.Left
        Sec.Parent = Scroll
        return Sec
    end

    local function CreateSwitch(text, default, callback)
        local Button = Instance.new("TextButton")
        Button.Name = text
        Button.Size = scaleUDim(260, 40)
        Button.BackgroundTransparency = 1
        Button.Text = ""
        Button.Parent = Scroll

        local Label = Instance.new("TextLabel")
        Label.Size = UDim2.new(1, -(60 * SCALE), 1, 0)
        Label.Position = UDim2.new(0, 15 * SCALE, 0, 0)
        Label.BackgroundTransparency = 1
        Label.Text = text
        Label.Font = Enum.Font.GothamMedium
        Label.TextSize = scaleSize(13)
        Label.TextColor3 = Theme.Text
        Label.TextXAlignment = Enum.TextXAlignment.Left
        Label.Parent = Button

        local SwitchBg = Instance.new("Frame")
        SwitchBg.Size = scaleUDim(36, 20)
        SwitchBg.Position = UDim2.new(1, -(50 * SCALE), 0.5, -(10 * SCALE))
        SwitchBg.BackgroundColor3 = default and Theme.ToggleOn or Theme.ToggleOff
        SwitchBg.BorderSizePixel = 0
        SwitchBg.Parent = Button

        local SwCorner = Instance.new("UICorner")
        SwCorner.CornerRadius = UDim.new(1, 0)
        SwCorner.Parent = SwitchBg

        local Circle = Instance.new("Frame")
        Circle.Size = scaleUDim(16, 16)
        local startX = default and (18 * SCALE) or (2 * SCALE)
        Circle.Position = UDim2.new(0, startX, 0.5, -(8 * SCALE))
        Circle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        Circle.BorderSizePixel = 0
        Circle.Parent = SwitchBg

        local CCorner = Instance.new("UICorner")
        CCorner.CornerRadius = UDim.new(1, 0)
        CCorner.Parent = Circle

        local enabled = default

        local function update()
            local targetX = enabled and (18 * SCALE) or (2 * SCALE)
            local targetColor = enabled and Theme.ToggleOn or Theme.ToggleOff
            TweenService:Create(Circle, TweenInfo.new(0.2), {Position = UDim2.new(0, targetX, 0.5, -(8 * SCALE))}):Play()
            TweenService:Create(SwitchBg, TweenInfo.new(0.2), {BackgroundColor3 = targetColor}):Play()
        end

        Button.MouseButton1Click:Connect(function()
            enabled = not enabled
            update()
            if callback then callback(enabled) end
            Shared.SaveConfig()
        end)

        local api = {}
        function api.Set(val) enabled = val update() end
        return api
    end

    local function CreateButton(text, callback)
        local Btn = Instance.new("TextButton")
        Btn.Size = scaleUDim(240, 30)
        Btn.BackgroundColor3 = Theme.ToggleOff
        Btn.Text = text
        Btn.TextColor3 = Theme.Text
        Btn.Font = Enum.Font.GothamBold
        Btn.TextSize = scaleSize(12)
        Btn.Parent = Scroll
        local corner = Instance.new("UICorner"); corner.CornerRadius = UDim.new(0, 6 * SCALE); corner.Parent = Btn
        local Wrapper = Instance.new("Frame"); Wrapper.BackgroundTransparency = 1; Wrapper.Size = scaleUDim(260, 36); Wrapper.Parent = Scroll
        Btn.Parent = Wrapper; Btn.Position = UDim2.new(0, 10 * SCALE, 0, 3 * SCALE)
        Btn.MouseButton1Click:Connect(function() if callback then callback(Btn) end end)
        return Btn
    end

    CreateSection("MAIN SETTINGS")
    CreateSwitch("Auto Armor", Shared.AutoArmor, function(s) Shared.AutoArmor = s if s then Load_AutoArmor() end end)
    CreateSwitch("Staff Notifier", Shared.StaffNotifier, function(s) Shared.StaffNotifier = s if s then Load_StaffNotifier() end end)
    CreateSwitch("Player Panel", Shared.PlayerPanel, function(s) Shared.PlayerPanel = s if s then Load_PlayerPanel() end end)
    CreateSwitch("Anti Fling", Shared.AntiFling, function(s) Shared.AntiFling = s if s then Load_AntiFling() end end)
    CreateSwitch("Instant Stomp", Shared.InstantStomp, function(s) Shared.InstantStomp = s if s then Load_InstantStomp() else Stop_InstantStomp() end end)
    CreateSwitch("Desync", Shared.Desync, function(s) Shared.Desync = s if s then Load_Desync() end end)
    CreateSwitch("Disable Desync", Shared.DisableDesync, function(s) Shared.DisableDesync = s if s then Load_DisableDesync() end end)
    CreateSwitch("FPS Boost", Shared.FpsBoost, function(s) Shared.FpsBoost = s if s then Load_FpsBoost() end end)
    CreateSwitch("Auto Reload", Shared.AutoReload, function(s) Shared.AutoReload = s if s then Load_AutoReload_S() end end)

    CreateSection("COMBAT / AIM")

    local AimWarnLabel = Instance.new("TextLabel")
    AimWarnLabel.Size = scaleUDim(260, 18)
    AimWarnLabel.BackgroundTransparency = 1
    AimWarnLabel.Text = ""
    AimWarnLabel.TextColor3 = Color3.fromRGB(220, 0, 0)
    AimWarnLabel.Font = Enum.Font.GothamBold
    AimWarnLabel.TextSize = scaleSize(9)
    AimWarnLabel.Visible = false
    AimWarnLabel.Parent = Scroll

    local function FlashAimWarn(txt)
        AimWarnLabel.Text = txt
        AimWarnLabel.Visible = true
        task.delay(2.2, function() if AimWarnLabel then AimWarnLabel.Visible = false end end)
    end

    local AimSwitch
    AimSwitch = CreateSwitch("Silent Aim", Shared.SilentAim, function(s)
        if s then
            if not Shared.SilentAimMethod then
                FlashAimWarn("Please select a Silent Aim Method first!")
                Shared.SilentAim = false
                AimSwitch.Set(false)
                return
            end
            if Shared.Platform == "PC" and Shared.SilentAimMethod == "MobileMethod" then
                FlashAimWarn("Mobile Method not available on PC!")
                Shared.SilentAim = false
                AimSwitch.Set(false)
                return
            end
            Shared.SilentAim = true
            Load_SilentAim_ByMethod()
        else
            Shared.SilentAim = false
            Stop_SilentAim_All()
        end
    end)

    local SilentAimMethodRow = Instance.new("Frame")
    SilentAimMethodRow.BackgroundTransparency = 1
    SilentAimMethodRow.Size = scaleUDim(260, 36)
    SilentAimMethodRow.Parent = Scroll

    local FOVBtn = Instance.new("TextButton")
    FOVBtn.Size = UDim2.new(0.45, 0, 1, 0)
    FOVBtn.Position = UDim2.new(0, 10 * SCALE, 0, 0)
    FOVBtn.BackgroundColor3 = Color3.fromRGB(45, 10, 10)
    FOVBtn.Text = "Silent Aim FOV Method"
    FOVBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    FOVBtn.Font = Enum.Font.GothamBold
    FOVBtn.TextSize = scaleSize(10)
    FOVBtn.Parent = SilentAimMethodRow
    Instance.new("UICorner", FOVBtn).CornerRadius = UDim.new(0, 6 * SCALE)

    local QBtn = Instance.new("TextButton")
    QBtn.Size = UDim2.new(0.45, 0, 1, 0)
    QBtn.Position = UDim2.new(0.5, 5 * SCALE, 0, 0)
    QBtn.BackgroundColor3 = Color3.fromRGB(45, 10, 10)
    QBtn.Text = "Silent Aim Q Method"
    QBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    QBtn.Font = Enum.Font.GothamBold
    QBtn.TextSize = scaleSize(10)
    QBtn.Parent = SilentAimMethodRow
    Instance.new("UICorner", QBtn).CornerRadius = UDim.new(0, 6 * SCALE)

    local MobileBtn = Instance.new("TextButton")
    MobileBtn.Size = UDim2.new(0.93, 0, 1, 0)
    MobileBtn.Position = UDim2.new(0, 10 * SCALE, 0, 0)
    MobileBtn.BackgroundColor3 = Color3.fromRGB(45, 10, 10)
    MobileBtn.Text = "Silent Aim Mobile Method"
    MobileBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    MobileBtn.Font = Enum.Font.GothamBold
    MobileBtn.TextSize = scaleSize(10)
    MobileBtn.Parent = SilentAimMethodRow
    Instance.new("UICorner", MobileBtn).CornerRadius = UDim.new(0, 6 * SCALE)

    local function updateMethodButtons()
        local on = Color3.fromRGB(200, 0, 0)
        local off = Color3.fromRGB(45, 10, 10)
        FOVBtn.BackgroundColor3 = (Shared.SilentAimMethod == "FOV") and on or off
        QBtn.BackgroundColor3 = (Shared.SilentAimMethod == "QMethod") and on or off
        MobileBtn.BackgroundColor3 = (Shared.SilentAimMethod == "MobileMethod") and on or off
        if Shared.Platform == "PC" then
            FOVBtn.Visible = true
            QBtn.Visible = true
            MobileBtn.Visible = false
            if Shared.SilentAimMethod == "MobileMethod" then
                Shared.SilentAimMethod = nil
                if Shared.SilentAim then Shared.SilentAim = false AimSwitch.Set(false) Stop_SilentAim_All() FlashAimWarn("Mobile Method not available on PC!") end
            end
        else
            FOVBtn.Visible = false
            QBtn.Visible = false
            MobileBtn.Visible = true
            if Shared.SilentAimMethod ~= "MobileMethod" then
                Shared.SilentAimMethod = nil
                if Shared.SilentAim then Shared.SilentAim = false AimSwitch.Set(false) Stop_SilentAim_All() FlashAimWarn("Select Mobile Method") end
            end
        end
    end

    FOVBtn.MouseButton1Click:Connect(function()
        if Shared.Platform ~= "PC" then return end
        if Shared.SilentAimMethod == "FOV" then
            Shared.SilentAimMethod = nil
            if Shared.SilentAim then Shared.SilentAim = false AimSwitch.Set(false) end
            Stop_SilentAim_All()
            updateMethodButtons()
            Shared.SaveConfig()
            return
        end
        local wasOn = Shared.SilentAim
        Shared.SilentAimMethod = "FOV"
        Shared.SaveConfig()
        updateMethodButtons()
        if wasOn then
            Stop_SilentAim_All()
            Load_SilentAim_ByMethod()
        end
    end)

    QBtn.MouseButton1Click:Connect(function()
        if Shared.Platform ~= "PC" then return end
        if Shared.SilentAimMethod == "QMethod" then
            Shared.SilentAimMethod = nil
            if Shared.SilentAim then Shared.SilentAim = false AimSwitch.Set(false) end
            Stop_SilentAim_All()
            updateMethodButtons()
            Shared.SaveConfig()
            return
        end
        local wasOn = Shared.SilentAim
        Shared.SilentAimMethod = "QMethod"
        Shared.SaveConfig()
        updateMethodButtons()
        if wasOn then
            Stop_SilentAim_All()
            Load_SilentAim_ByMethod()
        end
    end)

    MobileBtn.MouseButton1Click:Connect(function()
        if Shared.Platform ~= "Mobile" then return end
        if Shared.SilentAimMethod == "MobileMethod" then
            Shared.SilentAimMethod = nil
            if Shared.SilentAim then Shared.SilentAim = false AimSwitch.Set(false) end
            Stop_SilentAim_All()
            updateMethodButtons()
            Shared.SaveConfig()
            return
        end
        local wasOn = Shared.SilentAim
        Shared.SilentAimMethod = "MobileMethod"
        Shared.SaveConfig()
        updateMethodButtons()
        if wasOn then
            Stop_SilentAim_All()
            Load_SilentAim_ByMethod()
        end
    end)

    CreateSwitch("Camlock", Shared.Camlock, function(s)
        Shared.Camlock = s
        if s then
            if Shared.Platform == "Mobile" then Load_Camlock_Mobile() else Load_Camlock() end
        else
            Stop_Camlock_PC()
            Stop_Camlock_Mobile()
        end
    end)

    CreateSwitch("Triggerbot", Shared.TriggerBot, function(s) Shared.TriggerBot = s if s then Load_TriggerBot() end end)
    CreateSwitch("Drag Shoot", Shared.DragShoot, function(s) Shared.DragShoot = s if s then Load_DragShoot() end end)

    CreateSection("TARGET")

    local tBox = Instance.new("TextBox")
    tBox.Size = scaleUDim(240, 30)
    tBox.BackgroundColor3 = Theme.ToggleOff
    tBox.Text = Shared.TargetUsername or "Target Name..."
    tBox.TextColor3 = Theme.Text
    tBox.Font = Enum.Font.GothamMedium
    tBox.TextSize = scaleSize(12)
    tBox.PlaceholderText = "Type Player Name"
    local tWrap = Instance.new("Frame")
    tWrap.BackgroundTransparency = 1
    tWrap.Size = scaleUDim(260, 36)
    tWrap.Parent = Scroll
    tBox.Parent = tWrap
    tBox.Position = UDim2.new(0, 10 * SCALE, 0, 3 * SCALE)
    Instance.new("UICorner", tBox).CornerRadius = UDim.new(0, 6 * SCALE)

    tBox.FocusLost:Connect(function()
        local txt = tBox.Text
        for _, p in pairs(Players:GetPlayers()) do
            if string.find(string.lower(p.Name), string.lower(txt)) or string.find(string.lower(p.DisplayName), string.lower(txt)) then
                Shared.TargetUsername = p.Name
                tBox.Text = p.Name
                break
            end
        end
    end)

    CreateSwitch("View Target", Shared.ViewTarget, function(s) Shared.ViewTarget = s Load_Target() end)
    CreateSwitch("Highlight", Shared.HighlightTarget, function(s) Shared.HighlightTarget = s Load_Target() end)
    CreateSwitch("Auto Katana", Shared.AutoKatanaKill, function(s) Shared.AutoKatanaKill = s Load_Target() end)
    CreateSwitch("Fling Target", Shared.Fling, function(s) Shared.Fling = s Load_Target() end)
    CreateSwitch("OP Kill", Shared.OPKill, function(s) Shared.OPKill = s Load_Target() end)
    CreateSwitch("Aura", Shared.Aura, function(s) Shared.Aura = s Load_Target() end)
    CreateButton("Teleport to Target", function() Shared.GotoTarget = true Load_Target() end)

    CreateSection("SYSTEM")

    local PlatRow = Instance.new("Frame")
    PlatRow.BackgroundTransparency = 1
    PlatRow.Size = scaleUDim(260, 36)
    PlatRow.Parent = Scroll

    local PCBtn = Instance.new("TextButton")
    PCBtn.Size = UDim2.new(0.45, 0, 1, 0)
    PCBtn.Position = UDim2.new(0, 10 * SCALE, 0, 0)
    PCBtn.BackgroundColor3 = (Shared.Platform == "PC") and Theme.ToggleOn or Theme.ToggleOff
    PCBtn.Text = "PC VERSION"
    PCBtn.TextColor3 = Theme.Text
    PCBtn.Font = Enum.Font.GothamBold
    PCBtn.TextSize = scaleSize(10)
    PCBtn.Parent = PlatRow
    Instance.new("UICorner", PCBtn).CornerRadius = UDim.new(0, 6 * SCALE)

    local MobBtn = Instance.new("TextButton")
    MobBtn.Size = UDim2.new(0.45, 0, 1, 0)
    MobBtn.Position = UDim2.new(0.5, 5 * SCALE, 0, 0)
    MobBtn.BackgroundColor3 = (Shared.Platform == "Mobile") and Theme.ToggleOn or Theme.ToggleOff
    MobBtn.Text = "MOBILE VERSION"
    MobBtn.TextColor3 = Theme.Text
    MobBtn.Font = Enum.Font.GothamBold
    MobBtn.TextSize = scaleSize(10)
    MobBtn.Parent = PlatRow
    Instance.new("UICorner", MobBtn).CornerRadius = UDim.new(0, 6 * SCALE)

    local RestartLabel = Instance.new("TextLabel")
    RestartLabel.Size = scaleUDim(260, 20)
    RestartLabel.BackgroundTransparency = 1
    RestartLabel.Text = "Click Restart to apply Platform Mode changes"
    RestartLabel.TextColor3 = Theme.Accent
    RestartLabel.Font = Enum.Font.GothamBold
    RestartLabel.TextSize = scaleSize(9)
    RestartLabel.Visible = false
    RestartLabel.Parent = Scroll

    local function updatePlatBtns()
        PCBtn.BackgroundColor3 = (Shared.Platform == "PC") and Theme.ToggleOn or Theme.ToggleOff
        MobBtn.BackgroundColor3 = (Shared.Platform == "Mobile") and Theme.ToggleOn or Theme.ToggleOff
        SubTitle.Text = "Type: " .. Shared.Platform .. " (developed by schmeckt)"
        RestartLabel.Visible = true
        updateMethodButtons()
        Shared.SaveConfig()
    end

    PCBtn.MouseButton1Click:Connect(function() Shared.Platform = "PC" updatePlatBtns() end)
    MobBtn.MouseButton1Click:Connect(function() Shared.Platform = "Mobile" updatePlatBtns() end)

    CreateButton("Close GUI", function()
        DisableAllScripts()
        Shared.SaveConfig()
        ScreenGui:Destroy()
    end)

    CreateButton("Restart GUI", function()
        ScreenGui:Destroy()
        Shared.SaveConfig()
        MainUI()
    end)

    local UIList2 = Scroll:FindFirstChildOfClass("UIListLayout")
    Scroll.CanvasSize = UDim2.new(0, 0, 0, UIList2.AbsoluteContentSize.Y + (50 * SCALE))
    UIList2:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        Scroll.CanvasSize = UDim2.new(0, 0, 0, UIList2.AbsoluteContentSize.Y + (50 * SCALE))
    end)

    local dragging, dragInput, dragStart, startPos
    HubFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = HubFrame.Position
        end
    end)
    HubFrame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            HubFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)

    updateMethodButtons()
end

MainUI()

task.defer(function()
    if Shared.InstantStomp then Load_InstantStomp() end
    if Shared.AutoArmor then Load_AutoArmor() end
    if Shared.Desync then Load_Desync() end
    if Shared.SilentAim and Shared.SilentAimMethod then Load_SilentAim_ByMethod() end
    if Shared.TriggerBot then Load_TriggerBot() end
    if Shared.StaffNotifier then Load_StaffNotifier() end
    if Shared.FpsBoost then Load_FpsBoost() end
    if Shared.PlayerPanel then Load_PlayerPanel() end
    if Shared.Camlock then if Shared.Platform == "Mobile" then Load_Camlock_Mobile() else Load_Camlock() end end
    if Shared.AntiFling then Load_AntiFling() end
end)
